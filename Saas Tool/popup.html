<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRMSYNC</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup-container">
    <!-- Header -->
    <div class="popup-header">
      <button class="popup-contacts-btn" id="leftHeaderBtn" title="All Contacts">
        <span id="leftHeaderBtnIcon">ğŸ‘¥</span>
        <span id="leftHeaderBtnText" style="display: none; font-size: 13px; font-weight: 600; margin-left: 4px;"></span>
      </button>
      <div style="display: flex; align-items: center; gap: 6px;">
        <img src="icons/header-logo.png" alt="CRMSYNC" class="popup-logo-center" onerror="this.src='icons/widget-logo.png'" />
        <span id="subscriptionTierBadge" class="tier-badge tier-free">FREE</span>
      </div>
      <button class="popup-widget-btn" id="showWidgetBtn" title="Show Widget on Gmail">
        ğŸ“Œ
      </button>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <button class="tab-btn active" data-tab="all-contacts">
        <span>Contacts</span>
      </button>
      <button class="tab-btn" data-tab="overview">
        <span>Overview</span>
      </button>
      <button class="tab-btn" data-tab="daily-review">
        <span>Today</span>
      </button>
      <button class="tab-btn" data-tab="integrations">
        <span>ğŸ”Œ CRM</span>
      </button>
      <button class="tab-btn" data-tab="settings">
        <span>Settings</span>
      </button>
    </div>

    <!-- All Contacts Tab -->
    <div class="tab-content active" id="all-contacts-tab">
      <!-- Limit Warning Banner -->
      <div id="limitWarningBanner" style="display: none; background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%); color: white; padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; text-align: center; font-size: 13px; font-weight: 500;">
        <div style="margin-bottom: 8px;">âš ï¸ <span id="limitWarningText">You're at your contact limit!</span></div>
        <button id="upgradeLimitBtn" style="background: white; color: #ef4444; border: none; padding: 6px 16px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;">
          âœ¨ Upgrade to Pro
        </button>
      </div>
      
      <!-- Stats Row -->
      <div class="quick-stats">
        <div class="stat-mini">
          <span class="stat-mini-value" id="contactLimitInfo">0</span>
          <span class="stat-mini-label">Total</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-value" id="pendingCount">0</span>
          <span class="stat-mini-label">Pending</span>
        </div>
        <div class="stat-mini">
          <span class="stat-mini-value" id="newTodayMini">0</span>
          <span class="stat-mini-label">New</span>
        </div>
      </div>

      <!-- Search and Filters -->
      <div class="search-section">
        <input type="text" id="contactSearchInput" placeholder="Search contacts..." class="search-input">
        <div class="filter-row">
          <select id="statusFilter" class="select-input">
            <option value="">All</option>
            <option value="approved">Approved</option>
            <option value="pending">Pending</option>
            <option value="archived">Archived</option>
          </select>
          <select id="sortBy" class="select-input">
            <option value="lastContact">Recent</option>
            <option value="name">Name</option>
            <option value="company">Company</option>
          </select>
        </div>
      </div>

      <!-- Contacts Table -->
      <div class="contacts-table-wrapper">
        <table class="contacts-table">
          <thead>
            <tr>
              <th>Contact</th>
              <th>Company</th>
              <th>Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="allContactsTableBody">
            <!-- Contacts will be loaded here dynamically -->
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <button class="btn-icon" id="prevPage" disabled>â†</button>
        <span class="page-info" id="pageInfo">Page 1</span>
        <button class="btn-icon" id="nextPage" disabled>â†’</button>
      </div>

      <!-- Actions -->
      <div class="actions-row">
        <button class="btn-secondary" id="exportAllContactsCSV">
          Export CSV
        </button>
        <button class="btn-secondary" id="refreshAllContacts">
          Refresh
        </button>
      </div>
    </div>

    <!-- Overview Tab -->
    <div class="tab-content" id="overview-tab">
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalContacts">0</div>
          <div class="stat-label">Total Contacts</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="newToday">0</div>
          <div class="stat-label">New Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="pendingApprovals">0</div>
          <div class="stat-label">Pending</div>
        </div>
      </div>

      <!-- Pending Approvals -->
      <div class="section">
        <h3 class="section-title">Pending Approvals</h3>
        <div id="pendingList" class="contacts-list">
          <div class="empty-state">No pending approvals</div>
        </div>
      </div>

      <!-- Recent Contacts -->
      <div class="section">
        <div class="section-header">
          <h3 class="section-title">Recent Contacts</h3>
          <button class="btn-text" id="clearContacts">Clear All</button>
        </div>
        <div id="recentContactsList" class="contacts-list">
          <div class="empty-state">No recent contacts</div>
        </div>
      </div>

      <!-- Rejected Contacts -->
      <div class="section">
        <div class="section-header">
          <h3 class="section-title">ğŸš« Rejected Contacts</h3>
          <button class="btn-text" id="clearRejected">Clear All</button>
        </div>
        <div id="rejectedContactsList" class="contacts-list">
          <div class="empty-state">No rejected contacts</div>
        </div>
      </div>
    </div>

    <!-- Daily Review Tab -->
    <div class="tab-content" id="daily-review-tab">
      <!-- Today's Stats -->
      <div class="stats-grid-compact">
        <div class="stat-card-mini">
          <span class="stat-value-mini" id="reviewNewToday">0</span>
          <span class="stat-label-mini">New Today</span>
        </div>
        <div class="stat-card-mini">
          <span class="stat-value-mini" id="reviewTotalToday">0</span>
          <span class="stat-label-mini">Total Today</span>
        </div>
      </div>

      <!-- Today's Contacts -->
      <div class="section">
        <h3 class="section-title">ğŸ“… Today's Contacts</h3>
        <div id="dailyReviewList" class="contacts-list">
          <div class="empty-state">No contacts added today</div>
        </div>
      </div>

      <!-- Actions -->
      <button class="btn-primary" id="exportAndMarkReviewed">
        Export Today's Contacts
      </button>
    </div>

    <!-- Settings Tab -->
    <div class="tab-content" id="settings-tab">
      <div class="settings-section">
        <!-- General Settings -->
        <div class="setting-group">
          <h3 class="group-title">General</h3>
          
          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Dark Mode</label>
              <span class="setting-description">Switch to night theme</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="darkMode">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Sound Effects</label>
              <span class="setting-description">Play sounds on interactions</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="soundEffects">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Enable Sidebar</label>
              <span class="setting-description">Show sidebar in Gmail</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="sidebarEnabled" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Contact Management -->
        <div class="setting-group">
          <h3 class="group-title">Contact Management</h3>
          
          <div class="setting-item">
            <div class="setting-info">
              <label class="setting-label">Auto-Approve Contacts</label>
              <span class="setting-description">Skip manual approval</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="autoApprove">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Advanced -->
        <div class="setting-group">
          <h3 class="group-title">Advanced</h3>
          
          <div class="setting-item-full">
            <label class="setting-label">Track Gmail Labels</label>
            <input type="text" id="gmailLabelsInput" placeholder="e.g., Outreach, Prospects" class="text-input">
            <span class="setting-description">Comma-separated. Leave empty to track all emails</span>
          </div>

          <!-- Account Settings -->
          <div class="setting-item-full" id="accountSettingsContainer" style="margin-top: 24px; display: none;">
            <label class="setting-label">ğŸ‘¤ Account Settings</label>
            <div style="background: var(--surface); padding: 16px; border-radius: 12px; margin-top: 8px; border: 1px solid var(--border);">
              <div style="display: flex; flex-direction: column; gap: 12px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                  <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px;" id="accountAvatar">U</div>
                  <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="font-weight: 600; font-size: 14px; color: var(--text);" id="accountName">Loading...</div>
                      <span id="accountTier" style="font-size: 10px; padding: 2px 8px; border-radius: 12px; font-weight: 600; text-transform: uppercase; background: #10b981; color: white;">FREE</span>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);" id="accountEmail">Loading...</div>
                  </div>
                </div>
                <button class="btn-secondary" id="upgradeBtn" style="width: 100%; padding: 10px; border-radius: 8px; font-weight: 500; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; margin-bottom: 8px; display: none;">
                  âœ¨ Upgrade to Pro
                </button>
                <button class="btn-secondary" id="settingsSignOutBtn" style="width: 100%; padding: 10px; border-radius: 8px; font-weight: 500; background: #ef4444; color: white; border: none;">
                  ğŸšª Sign Out
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Exclusions -->
        <div class="setting-group">
          <h3 class="group-title">ğŸš« Exclusions</h3>
          <p style="margin: 0 0 16px 0; font-size: 13px; color: var(--text-secondary); line-height: 1.5;">
            Block specific contacts from being tracked. Use commas to separate multiple entries.
          </p>
          
          <div class="setting-item-full">
            <label class="setting-label">ğŸ“§ Exclude Email Domains</label>
            <div class="tag-input-container">
              <div class="tags-display" id="excludeDomainsTags"></div>
              <input type="text" id="excludeDomainsInput" placeholder="Type domain and press Enter..." class="tag-text-input">
            </div>
            <span class="setting-description">
              âŒ Blocks: anyone@<strong>yourcompany.com</strong><br>
              ğŸ’¡ Type domain and press <strong>Enter</strong> to add
            </span>
          </div>

          <div class="setting-item-full">
            <label class="setting-label">ğŸ‘¤ Exclude Names</label>
            <div class="tag-input-container">
              <div class="tags-display" id="excludeNamesTags"></div>
              <input type="text" id="excludeNamesInput" placeholder="Type name and press Enter..." class="tag-text-input">
            </div>
            <span class="setting-description">
              <strong>Full Name:</strong> "John Smith" â†’ Blocks ONLY John Smith<br>
              ğŸ’¡ Type name and press <strong>Enter</strong> to add
            </span>
          </div>

          <div class="setting-item-full">
            <label class="setting-label">ğŸ“ Exclude Phone Numbers</label>
            <div class="tag-input-container">
              <div class="tags-display" id="excludePhonesTags"></div>
              <input type="text" id="excludePhonesInput" placeholder="Type phone and press Enter..." class="tag-text-input">
            </div>
            <span class="setting-description">
              âŒ Blocks these phone numbers<br>
              ğŸ’¡ Type number and press <strong>Enter</strong> to add
            </span>
          </div>
        </div>

        <!-- Data Management -->
        <div class="setting-group">
          <h3 class="group-title">Data</h3>
          <button class="btn-danger" id="clearAllData">
            <span>ğŸ—‘ï¸</span>
            <span>Clear All Data</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Integrations Tab -->
    <div class="tab-content" id="integrations-tab">
      <div class="tab-header">
        <h2>ğŸ”Œ CRM Integrations</h2>
        <p class="tab-subtitle">Connect your CRM to sync contacts automatically</p>
      </div>

      <!-- HubSpot Integration Card -->
      <div class="integration-card">
        <div class="integration-header">
          <div class="integration-logo-container">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23ff7a59'/%3E%3C/svg%3E" alt="HubSpot" class="integration-logo">
            <div class="integration-logo-text">H</div>
          </div>
          <div class="integration-info">
            <h3>HubSpot</h3>
            <p class="integration-status" id="hubspot-status">Not connected</p>
            <p class="integration-meta" id="hubspot-last-sync" style="display: none;">Last synced: Never</p>
            <p class="integration-meta" id="hubspot-count" style="display: none;">0 contacts synced</p>
          </div>
        </div>
        <div class="integration-actions">
          <button class="btn btn-primary" id="hubspot-connect-btn">
            <span>Connect HubSpot</span>
          </button>
          <button class="btn btn-secondary hidden" id="hubspot-sync-all-btn">
            <span>ğŸ”„ Sync All Contacts</span>
          </button>
          <button class="btn btn-danger hidden" id="hubspot-disconnect-btn">
            <span>Disconnect</span>
          </button>
        </div>
      </div>

      <!-- Salesforce Integration Card -->
      <div class="integration-card">
        <div class="integration-header">
          <div class="integration-logo-container">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%2300a1e0'/%3E%3C/svg%3E" alt="Salesforce" class="integration-logo">
            <div class="integration-logo-text">S</div>
          </div>
          <div class="integration-info">
            <h3>Salesforce</h3>
            <p class="integration-status" id="salesforce-status">Not connected</p>
            <p class="integration-meta" id="salesforce-last-sync" style="display: none;">Last synced: Never</p>
            <p class="integration-meta" id="salesforce-count" style="display: none;">0 contacts synced</p>
          </div>
        </div>
        <div class="integration-actions">
          <button class="btn btn-primary" id="salesforce-connect-btn">
            <span>Connect Salesforce</span>
          </button>
          <button class="btn btn-secondary hidden" id="salesforce-sync-all-btn">
            <span>ğŸ”„ Sync All Contacts</span>
          </button>
          <button class="btn btn-danger hidden" id="salesforce-disconnect-btn">
            <span>Disconnect</span>
          </button>
        </div>
      </div>

      <!-- Info Box -->
      <div class="info-box">
        <h4>ğŸ’¡ How it works</h4>
        <ul>
          <li><strong>Connect:</strong> Authorize access to your CRM (secure OAuth)</li>
          <li><strong>Sync:</strong> Pull existing contacts to show "âœ“ In CRM" badges</li>
          <li><strong>Push:</strong> Add new contacts with one click</li>
          <li><strong>Automatic:</strong> Duplicate detection prevents duplicates</li>
        </ul>
        <p class="info-note">
          ğŸ”’ Your credentials are never stored in the extension. All connections are secure and can be disconnected anytime.
        </p>
      </div>
    </div>
  </div>

  <!-- Data Merge Dialog -->
  <div id="dataMergeDialog" class="data-merge-overlay">
    <div style="background: white; padding: 32px; border-radius: 16px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
      <div style="text-align: center; margin-bottom: 24px;">
        <div style="font-size: 48px; margin-bottom: 12px;">ğŸ”„</div>
        <h2 style="margin: 0 0 8px 0; font-size: 22px; color: #1e293b;">Welcome Back!</h2>
        <p style="margin: 0; color: #64748b; font-size: 14px; line-height: 1.5;">
          You have <strong id="localContactCount">0</strong> contacts saved locally. Would you like to keep them or use your synced data?
        </p>
      </div>
      
      <div style="display: flex; flex-direction: column; gap: 12px;">
        <button id="keepLocalDataBtn" class="data-merge-btn-primary" style="padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.2s;">
          ğŸ“¦ Keep My Local Data
          <div style="font-size: 12px; font-weight: 400; opacity: 0.9; margin-top: 4px;">
            Merge local contacts with cloud data
          </div>
        </button>
        
        <button id="useSyncedDataBtn" class="data-merge-btn-secondary" style="padding: 16px; background: white; color: #475569; border: 2px solid #e2e8f0; border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.2s;">
          â˜ï¸ Use Synced Data
          <div style="font-size: 12px; font-weight: 400; opacity: 0.8; margin-top: 4px;">
            Replace local data with cloud data
          </div>
        </button>
        
        <button id="cancelMergeBtn" class="data-merge-btn-cancel" style="padding: 12px; background: transparent; color: #94a3b8; border: none; font-size: 13px; cursor: pointer; transition: all 0.2s;">
          Decide Later
        </button>
      </div>
    </div>
  </div>
  
  <style>
    .data-merge-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }
    .data-merge-btn-secondary:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }
    .data-merge-btn-cancel:hover {
      color: #64748b;
    }
  </style>

  <!-- Core Scripts -->
  <script src="config.js"></script>
  <script src="auth.js"></script>
  <script src="sync.js"></script>
  <script src="integrations.js"></script>
  
  <!-- UX Enhancement Scripts -->
  <script src="toast.js"></script>
  <script src="darkMode.js"></script>
  <script src="quickActions.js"></script>
  <script src="analytics.js"></script>
  
  <!-- Feature Scripts -->
  <script src="guest-mode-banner.js"></script>
  <script src="popup-subscription.js"></script>
  <script src="popup.js"></script>
  <script src="popup-enhancements.js"></script>
</body>
</html>
